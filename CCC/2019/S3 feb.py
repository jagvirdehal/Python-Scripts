t = input().split()
rows = int(t[0])
cols = int(t[1])

map = []
empty = []
conveyor = {}
start = ()
#movable = []
cameras = set()

for i in range(rows):
    t = input()
    map.append(list(t))
    try:
        start = (i,t.index("S"))
    except ValueError:
        continue

for x in range(rows):
    for y in range(cols):
        location = map[x][y]
        if location == "W" or location == "S":
            continue
        elif location == ".":
            empty.append((x,y))
        elif location == "C":
            cameras.add((x,y))
        elif location in ("U","D","L","R"):
            conveyor[(x,y)] = location

emptyBC = empty[:]

def cam(i,direction):
    pos = list(i)
    location = map[pos[0]][pos[1]]
    while location != "W":
        if tuple(pos) in empty:
            empty.remove(tuple(pos))
        pos[0] += direction[0]
        pos[1] += direction[1]
        location = map[pos[0]][pos[1]]

for i in cameras:
    cam(i, (-1, 0))
    cam(i, (1, 0))
    cam(i, (0, -1))
    cam(i, (0, 1))

#movable = empty + list(conveyor.keys())
veyor = set(conveyor.keys())

def convey(coord):
    newCoord = list(coord[:])
    if conveyor[coord] == "U":
        newCoord[0] += -1
    elif conveyor[coord] == "D":
        newCoord[0] += 1
    elif conveyor[coord] == "L":
        newCoord[1] += -1
    elif conveyor[coord] == "R":
        newCoord[1] += 1
    return tuple(newCoord)

def adjacent(curr):
    adj = set()
    test = {
        (curr[0] - 1, curr[1]),
        (curr[0] + 1, curr[1]),
        (curr[0], curr[1] - 1),
        (curr[0], curr[1] + 1)
    }
    for i in test:
        count = 0
        while i in veyor and count < 5: # and (count < rows + cols)
            i = convey(i)
            count += 1
        if i in empty:
            adj.add(i)
    return adj

adj = {}
open = {}
closed = {}
infinity = 1000000
startNode = start[:]

open[start] = 0
for i in empty:
    open[i] = infinity
#    adj[i] = adjacent(i)

while open:
    currentNode = min(open, key=open.get)
    if open[currentNode] == infinity:
        open = {}
        break
    for i in adjacent(currentNode):
        dist = open[currentNode] + 1
        if i in open and open[i] > dist:
            open[i] = dist
    closed[currentNode] = open.pop(currentNode)
    try:
        empty.remove(currentNode)
    except ValueError:
        continue

for i in emptyBC:
    if i in closed:
        print(closed[i])
    else:
        print(-1)

'''
4 5
WWWWW
W.W.W
WWS.W
WWWWW
'''

'''
5 7
WWWWWWW
WD.L.RW
W.WCU.W
WWW.S.W
WWWWWWW
'''

'''
100 100
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
WS..........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
W...........................................................................................................................W
WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
'''